version: "2"

run:
  relative-path-mode: gitroot
  issues-exit-code: 1
  tests: true
  allow-parallel-runners: true

output:
  formats:
    text:
      path: stdout
      print-linter-name: true
      print-issued-lines: true
      colors: true

issues:
  max-issues-per-linter: 0
  max-same-issues: 0
  uniq-by-line: false

formatters:
  enable:
    # - gci
    - gofmt
    - gofumpt
    - goimports

  # Formatters settings.
  settings:
    gci:
      # Default: ["standard", "default"]
      sections:
        - standard                       # Standard section: captures all standard packages.
        - default                        # Default section: contains all imports that could not be matched to another section type.
        - prefix(github.com/org/project) # Custom section: groups all imports with the specified Prefix.
        - blank                          # Blank section: contains all blank imports. This section is not present unless explicitly enabled.
        - dot                            # Dot section: contains all dot imports. This section is not present unless explicitly enabled.
        - alias                          # Alias section: contains all alias imports. This section is not present unless explicitly enabled.
        - localmodule                    # Local module section: contains all local packages. This section is not present unless explicitly enabled.
      no-inline-comments: false
      no-prefix-comments: false
      custom-order: false
      no-lex-order: false

    gofmt:
      simplify: true
      rewrite-rules:
        - pattern: 'interface{}'
          replacement: 'any'

    gofumpt:
      module-path: github.com/zchee/tumix/gollm/xai
      extra-rules: true

    goimports:
      local-prefixes:
        - github.com/zchee/tumix/gollm/xai

linters:
  default: none
  enable:
    - arangolint                # Opinionated best practices for arangodb client.
    - asasalint                 # Check for pass []any as any in variadic func(...any).
    - asciicheck                # Checks that all code identifiers does not have non-ASCII symbols in the name. [fast]
    - bidichk                   # Checks for dangerous unicode character sequences. [fast]
    - bodyclose                 # Checks whether HTTP response body is closed successfully.
    - canonicalheader           # Canonicalheader checks whether net/http.Header uses canonical header. [auto-fix]
    - contextcheck              # Check whether the function uses a non-inherited context.
    - copyloopvar               # A linter detects places where loop variables are copied. [fast, auto-fix]
    - depguard                  # Go linter that checks if package imports are in a list of acceptable packages. [fast]
    - dogsled                   # Checks assignments with too many blank identifiers (e.g. x, _, _, _, := f()). [fast]
    - dupl                      # Detects duplicate fragments of code. [fast]
    - dupword                   # Checks for duplicate words in the source code. [fast, auto-fix]
    - durationcheck             # Check for two durations multiplied together.
    - embeddedstructfieldcheck  # Embedded types should be at the top of the field list of a struct, and there must be an empty line separating embedded fields from regular fields. [fast]
    - errcheck                  # Errcheck is a program for checking for unchecked errors in Go code. These unchecked errors can be critical bugs in some cases.
    - errchkjson                # Checks types passed to the json encoding functions. Reports unsupported types and reports occurrences where the check for the returned error can be omitted.
    - errname                   # Checks that sentinel errors are prefixed with the `Err` and error types are suffixed with the `Error`.
    - errorlint                 # Find code that can cause problems with the error wrapping scheme introduced in Go 1.13. [auto-fix]
    - exptostd                  # Detects functions from golang.org/x/exp/ that can be replaced by std functions. [auto-fix]
    - fatcontext                # Detects nested contexts in loops and function literals. [auto-fix]
    - forbidigo                 # Forbids identifiers.
    - ginkgolinter              # Enforces standards of using ginkgo and gomega. [auto-fix]
    - gocheckcompilerdirectives # Checks that go compiler directive comments (//go:) are valid. [fast]
    - gochecksumtype            # Run exhaustiveness checks on Go "sum types".
    - goconst                   # Finds repeated strings that could be replaced by a constant.
    - gocritic                  # Provides diagnostics that check for bugs, performance and style issues. [auto-fix]
    - godoclint                 # Checks Golang's documentation practice (godoc). [fast]
    - godot                     # Check if comments end in a period. [fast, auto-fix]
    - goheader                  # Check if file header matches to pattern. [fast, auto-fix]
    - gomodguard                # Allow and blocklist linter for direct Go module dependencies. This is different from depguard where there are different block types for example version constraints and module recommendations. [fast]
    - goprintffuncname          # Checks that printf-like functions are named with `f` at the end. [fast]
    - gosec                     # Inspects source code for security problems.
    - gosmopolitan              # Report certain i18n/l10n anti-patterns in your Go codebase.
    - govet                     # Vet examines Go source code and reports suspicious constructs. It is roughly the same as 'go vet' and uses its passes. [auto-fix]
    - grouper                   # Analyze expression groups. [fast]
    - importas                  # Enforces consistent import aliases. [auto-fix]
    - inamedparam               # Reports interfaces with unnamed method parameters. [fast]
    - ineffassign               # Detects when assignments to existing variables are not used. [fast]
    - interfacebloat            # A linter that checks the number of methods inside an interface. [fast]
    - intrange                  # Intrange is a linter to find places where for loops could make use of an integer range. [auto-fix]
    - iotamixing                # Checks if iotas are being used in const blocks with other non-iota declarations. [fast]
    - lll                       # Reports long lines. [fast]
    - loggercheck               # Checks key value pairs for common logger libraries (kitlog,klog,logr,slog,zap).
    - maintidx                  # Maintidx measures the maintainability index of each function. [fast]
    - makezero                  # Find slice declarations with non-zero initial length.
    - mirror                    # Reports wrong mirror patterns of bytes/strings usage. [auto-fix]
    - misspell                  # Finds commonly misspelled English words. [fast, auto-fix]
    - modernize                 # A suite of analyzers that suggest simplifications to Go code, using modern language and library features.
    - musttag                   # Enforce field tags in (un)marshaled structs.
    - nakedret                  # Checks that functions with naked returns are not longer than a maximum size (can be zero). [fast, auto-fix]
    - nestif                    # Reports deeply nested if statements. [fast]
    - nilerr                    # Find the code that returns nil even if it checks that the error is not nil.
    - nilnesserr                # Reports constructs that checks for err != nil, but returns a different nil value error.
    - nilnil                    # Checks that there is no simultaneous return of `nil` error and an invalid value.
    - noctx                     # Detects function and method with missing usage of context.Context.
    - nolintlint                # Reports ill-formed or insufficient nolint directives. [fast, auto-fix]
    - nosprintfhostport         # Checks for misuse of Sprintf to construct a host with port in a URL. [fast]
    - prealloc                  # Find slice declarations that could potentially be pre-allocated. [fast]
    - predeclared               # Find code that shadows one of Go's predeclared identifiers. [fast]
    - promlinter                # Check Prometheus metrics naming via promlint. [fast]
    - protogetter               # Reports direct reads from proto message fields when getters should be used. [auto-fix]
    - reassign                  # Checks that package variables are not reassigned.
    - recvcheck                 # Checks for receiver type consistency.
    - revive                    # Fast, configurable, extensible, flexible, and beautiful linter for Go. Drop-in replacement of golint. [auto-fix]
    - rowserrcheck              # Checks whether Rows.Err of rows is checked successfully.
    - sloglint                  # Ensure consistent code style when using log/slog. [auto-fix]
    - spancheck                 # Checks for mistakes with OpenTelemetry/Census spans.
    - staticcheck               # It's the set of rules from staticcheck. [auto-fix]
    - tagalign                  # Check that struct tags are well aligned. [fast, auto-fix]
    - tagliatelle               # Checks the struct tags.
    - testableexamples          # Linter checks if examples are testable (have an expected output). [fast]
    - thelper                   # Thelper detects tests helpers which do not start with the t.Helper() method.
    - tparallel                 # Tparallel detects inappropriate usage of t.Parallel() method in your Go test codes.
    - unconvert                 # Remove unnecessary type conversions.
    - unparam                   # Reports unused function parameters.
    - unqueryvet                # Detects SELECT * in SQL queries and SQL builders, preventing performance issues and encouraging explicit column selection. [fast]
    - unused                    # Checks Go code for unused constants, variables, functions and types.
    - usestdlibvars             # A linter that detect the possibility to use variables/constants from the Go standard library. [fast, auto-fix]
    - usetesting                # Reports uses of functions with replacement inside the testing package. [auto-fix]
    - varnamelen                # Checks that the length of a variable's name matches its scope.
    - wastedassign              # Finds wasted assignment statements.
    - whitespace                # Whitespace is a linter that checks for unnecessary newlines at the start and end of functions, if, for, etc. [fast, auto-fix]
    - wrapcheck                 # Checks that errors returned from external packages are wrapped.

  disable:
    - containedctx              # Containedctx is a linter that detects struct contained context.Context field.
    - cyclop                    # Checks function and package cyclomatic complexity. [fast]
    - decorder                  # Check declaration order and count of types, constants, variables and functions. [fast]
    - err113                    # Check errors handling expressions. [auto-fix]
    - exhaustive                # Check exhaustiveness of enum switch statements.
    - exhaustruct               # Checks if all structure fields are initialized.
    - forcetypeassert           # Find forced type assertions.
    - funcorder                 # Checks the order of functions, methods, and constructors. [fast]
    - funlen                    # Checks for long functions. [fast]
    - gochecknoglobals          # Check that no global variables exist.
    - gochecknoinits            # Checks that no init functions are present in Go code. [fast]
    - gocognit                  # Computes and checks the cognitive complexity of functions. [fast]
    - gocyclo                   # Computes and checks the cyclomatic complexity of functions. [fast]
    - godox                     # Detects usage of FIXME, TODO and other keywords inside comments. [fast]
    - gomoddirectives           # Manage the use of 'replace', 'retract', and 'excludes' directives in go.mod. [fast]
    - iface                     # Detect the incorrect use of interfaces, helping developers avoid interface pollution. [auto-fix]
    - ireturn                   # Accept Interfaces, Return Concrete Types.
    - mnd                       # An analyzer to detect magic numbers. [fast]
    - nlreturn                  # Checks for a new line before return and branch statements to increase code clarity. [fast, auto-fix]
    - noinlineerr               # Disallows inline error handling (`if err := ...; err != nil {`).
    - nonamedreturns            # Reports all named returns.
    - paralleltest              # Detects missing usage of t.Parallel() method in your Go test.
    - perfsprint                # Checks that fmt.Sprintf can be replaced with a faster alternative. [auto-fix]
    - sqlclosecheck             # Checks that sql.Rows, sql.Stmt, sqlx.NamedStmt, pgx.Query are closed.
    - testifylint               # Checks usage of github.com/stretchr/testify. [auto-fix]
    - testpackage               # Linter that makes you use a separate _test package. [fast]
    - wsl_v5                    # Add or remove empty lines. [auto-fix]
    - zerologlint               # Detects the wrong usage of `zerolog` that a user forgets to dispatch with `Send` or `Msg`.

  settings:
    asasalint:
      use-builtin-exclusions: true
    bidichk:
      left-to-right-embedding: true
      right-to-left-embedding: true
      pop-directional-formatting: true
      left-to-right-override: true
      right-to-left-override: true
      left-to-right-isolate: true
      right-to-left-isolate: true
      first-strong-isolate: true
      pop-directional-isolate: true
    copyloopvar:
      check-alias: true
    cyclop:
      max-complexity: 15
      package-average: 0.5
    decorder:
      dec-order:
        - type
        - const
        - var
        - func
      ignore-underscore-vars: false
      disable-dec-num-check: false
      disable-type-dec-num-check: false
      disable-const-dec-num-check: false
      disable-var-dec-num-check: false
      disable-dec-order-check: false
      disable-init-func-first-check: false
    depguard:
      rules:
        stdlib_v2:
          list-mode: original
          files:
            - $all
          deny:
            - pkg: "encoding/json$"
              desc: Use "encoding/json/v2" instead of.
            - pkg: "math/rand$"
              desc: Use "math/rand/v2" instead of.
    dogsled:
      max-blank-identifiers: 3
    dupl:
      threshold: 150
    dupword:
      keywords:
        - the
        - and
        - a
      ignore:
        - 0C0C
    errcheck:
      check-type-assertions: false
      disable-default-exclusions: true
      check-blank: true
      exclude-functions:
        - (*bytes.Buffer).Write
        - (*strings.Builder).WriteString
      verbose: true
    errchkjson:
      check-error-free-encoding: true
      report-no-exported: false
    errorlint:
      errorf: true
      errorf-multi: true
      asserts: true
      comparison: true
    funlen:
      lines: 120
      statements: 60
      ignore-comments: true
    gocognit:
      min-complexity: 25
    goconst:
      match-constant: true
      min-len: 3
      min-occurrences: 3
      numbers: true
      min: 3
      max: 3
      ignore-calls: true
    gocritic:
      enable-all: true
      disabled-checks:
        - commentedOutCode
        - whyNoLint
      settings:
        hugeParam:
          sizeThreshold: 80
        rangeExprCopy:
          sizeThreshold: 512
        rangeValCopy:
          sizeThreshold: 128
    gocyclo:
      min-complexity: 20
    godot:
      scope: declarations
      capital: false
      period: true
    goheader:
      template: |-
        Copyright {{ YEAR }} The tumix Authors.

        Licensed under the Apache License, Version 2.0 (the "License");
        you may not use this file except in compliance with the License.
        You may obtain a copy of the License at

        	http://www.apache.org/licenses/LICENSE-2.0

        Unless required by applicable law or agreed to in writing, software
        distributed under the License is distributed on an "AS IS" BASIS,
        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        See the License for the specific language governing permissions and
        limitations under the License.

        SPDX-License-Identifier: Apache-2.0
    gosec:
      excludes:
        - G301
    govet:
      disable:
        - fieldalignment
      enable-all: true
    importas:
      no-unaliased: true
      no-extra-aliases: false
    inamedparam:
      skip-single-param: false
    interfacebloat:
      max: 10
    lll:
      line-length: 250
      tab-width: 1
    maintidx:
      under: 15
    makezero:
      always: false
    misspell:
      locale: US
      ignore-rules:
        - cancelled
        - cancelling
    nakedret:
      max-func-lines: 30
    nestif:
      min-complexity: 5
    prealloc:
      simple: true
      range-loops: true
      for-loops: false
    revive:
      severity: warning
      enable-all-rules: false
      enable-default-rules: true
    sloglint:
      no-mixed-args: true
      kv-only: false
      attr-only: false
      no-global: ""
      context: all
      static-msg: false
      no-raw-keys: false
      key-naming-case: snake
      args-on-sep-lines: false
    spancheck:
      checks:
        - end
        - record-error
        - set-status
      ignore-check-signatures:
        - telemetry.RecordError
    testpackage:
      skip-regexp: .*(export)_test\.go
    unconvert:
      fast-math: true
      safe: true
    unparam:
      check-exported: true
    unused:
      field-writes-are-uses: true
      post-statements-are-reads: false
      exported-fields-are-used: true
      parameters-are-used: true
      local-variables-are-used: true
      generated-is-used: true
    usestdlibvars:
      http-method: true
      http-status-code: true
      time-weekday: true
      time-month: false
      time-layout: true
      crypto-hash: true
      tls-signature-scheme: false
      constant-kind: false
    varnamelen:
      max-distance: 5
      min-name-length: 1
      check-receiver: true
      check-return: true
      ignore-type-assert-ok: false
      ignore-map-index-ok: false
      ignore-chan-recv-ok: false
    whitespace:
      multi-if: false
      multi-func: true

  exclusions:
    generated: lax
    presets:
      - comments
      - std-error-handling
      - common-false-positives
      - legacy
    rules:
      - linters:
          - cyclop
          - funlen
          - gocognit
          - goconst
          - gocritic
          - gocyclo
          - gosec
          - lll
          - wrapcheck
        path: _test\.go

      - linters:
          - lll
        source: "^//go:generate "

      - linters:
          - decorder
          - gosec
          - revive
          - wrapcheck
        path: .

      - linters:
          - decorder
          - revive
          - wrapcheck
          - cyclop
        path: examples

      - linters:
          - goheader
        path: internal/grpccodec/mem

      - linters:
          - unparam
        text: "(\\*Reader).Close" # io.Closer
        path: internal/grpccodec/mem

      - linters:
          - govet
        text: 'shadow: declaration of "err|ok|ctx"'

      - linters:
          - nlreturn
        text: continue with no blank line before

      # gosec(G404): Insecure random number source (rand)
      # staticcheck(ST1003): Poorly chosen identifier: https://staticcheck.dev/docs/checks/#ST1003
      - path: (.+)\.go$
        text: (G404|ST1003) 

      - path: (.+)\.go$
        text: Error return value of `.*.Add(Array|Object)` is not checked
