version: "2"

run:
  relative-path-mode: gomod
  issues-exit-code: 1
  tests: true
  # modules-download-mode: readonly
  allow-parallel-runners: true

output:
  formats:
    text:
      path: stdout
      print-linter-name: true
      print-issued-lines: true
      colors: true

issues:
  max-issues-per-linter: 0
  max-same-issues: 0
  uniq-by-line: false

formatters:
  enable:
    # - gci
    - gofmt
    - gofumpt
    - goimports

  # Formatters settings.
  settings:
    gci:
      # Default: ["standard", "default"]
      sections:
        - standard                       # Standard section: captures all standard packages.
        - default                        # Default section: contains all imports that could not be matched to another section type.
        - prefix(github.com/org/project) # Custom section: groups all imports with the specified Prefix.
        - blank                          # Blank section: contains all blank imports. This section is not present unless explicitly enabled.
        - dot                            # Dot section: contains all dot imports. This section is not present unless explicitly enabled.
        - alias                          # Alias section: contains all alias imports. This section is not present unless explicitly enabled.
        - localmodule                    # Local module section: contains all local packages. This section is not present unless explicitly enabled.
      no-inline-comments: false
      no-prefix-comments: false
      custom-order: false
      no-lex-order: false

    gofmt:
      simplify: true
      rewrite-rules:
        - pattern: 'interface{}'
          replacement: 'any'

    gofumpt:
      module-path: github.com/zchee/tumix
      extra-rules: true

    goimports:
      local-prefixes:
        - github.com/zchee/tumix
        - github.com/zchee/tumix/gollm/xai

linters:
  default: none
  enable:
    - arangolint
    - asasalint
    - asciicheck
    - bidichk
    - bodyclose
    - canonicalheader
    - contextcheck
    - copyloopvar
    # - cyclop
    # - decorder
    - depguard
    - dogsled
    - dupl
    - dupword
    - durationcheck
    - embeddedstructfieldcheck
    - errcheck
    - errchkjson
    - errname
    - errorlint
    - exptostd
    - fatcontext
    - forbidigo
    - ginkgolinter
    - gocheckcompilerdirectives
    - gochecksumtype
    - gocritic
    - godoclint
    - godot
    - goheader
    - gomodguard
    - goprintffuncname
    - gosec
    - gosmopolitan
    - govet
    - grouper
    - importas
    - inamedparam
    - ineffassign
    - interfacebloat
    - intrange
    - iotamixing
    - lll
    - loggercheck
    - maintidx
    - makezero
    - mirror
    - misspell
    - modernize
    - musttag
    - nakedret
    - nestif
    - nilerr
    - nilnesserr
    - nilnil
    - noctx
    - nolintlint
    - nosprintfhostport
    - prealloc
    - predeclared
    - promlinter
    - protogetter
    - reassign
    - recvcheck
    - revive
    - rowserrcheck
    - sloglint
    - spancheck
    - sqlclosecheck
    - staticcheck
    - tagalign
    - tagliatelle
    - testableexamples
    - thelper
    - tparallel
    - unconvert
    - unparam
    - unqueryvet
    - unused
    - usestdlibvars
    - usetesting
    - varnamelen
    - wastedassign
    - whitespace
    - wrapcheck
    - zerologlint

  settings:
    asasalint:
      use-builtin-exclusions: true
    bidichk:
      left-to-right-embedding: true
      right-to-left-embedding: true
      pop-directional-formatting: true
      left-to-right-override: true
      right-to-left-override: true
      left-to-right-isolate: true
      right-to-left-isolate: true
      first-strong-isolate: true
      pop-directional-isolate: true
    copyloopvar:
      check-alias: true
    cyclop:
      max-complexity: 15
      package-average: 0.5
    decorder:
      dec-order:
        - type
        - const
        - var
        - func
      ignore-underscore-vars: false
      disable-dec-num-check: false
      disable-type-dec-num-check: false
      disable-const-dec-num-check: false
      disable-var-dec-num-check: false
      disable-dec-order-check: false
      disable-init-func-first-check: false
    depguard:
      rules:
        stdlib_v2:
          list-mode: original
          files:
            - $all
          deny:
            - pkg: "encoding/json$"
              desc: Use "encoding/json/v2" instead of.
            - pkg: "math/rand$"
              desc: Use "math/rand/v2" instead of.
    dogsled:
      max-blank-identifiers: 3
    dupl:
      threshold: 150
    dupword:
      keywords:
        - the
        - and
        - a
      ignore:
        - 0C0C
    errcheck:
      check-type-assertions: false
      disable-default-exclusions: true
      check-blank: true
      exclude-functions:
        - (*bytes.Buffer).Write
        - (*strings.Builder).WriteString
      verbose: true
    errchkjson:
      check-error-free-encoding: true
      report-no-exported: false
    errorlint:
      errorf: true
      errorf-multi: true
      asserts: true
      comparison: true
    funlen:
      lines: 120
      statements: 60
      ignore-comments: true
    gocognit:
      min-complexity: 25
    goconst:
      match-constant: true
      min-len: 3
      min-occurrences: 3
      numbers: true
      min: 3
      max: 3
      ignore-calls: true
    gocritic:
      enable-all: true
      disabled-checks:
        - commentedOutCode
        - whyNoLint
      settings:
        hugeParam:
          sizeThreshold: 80
        rangeExprCopy:
          sizeThreshold: 512
        rangeValCopy:
          sizeThreshold: 128
    gocyclo:
      min-complexity: 20
    godot:
      scope: declarations
      capital: false
      period: true
    goheader:
      template: |-
        Copyright {{ YEAR }} The tumix Authors.

        Licensed under the Apache License, Version 2.0 (the "License");
        you may not use this file except in compliance with the License.
        You may obtain a copy of the License at

        	http://www.apache.org/licenses/LICENSE-2.0

        Unless required by applicable law or agreed to in writing, software
        distributed under the License is distributed on an "AS IS" BASIS,
        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        See the License for the specific language governing permissions and
        limitations under the License.

        SPDX-License-Identifier: Apache-2.0
    gosec:
      excludes:
        - G301
    govet:
      disable:
        - fieldalignment
      enable-all: true
    importas:
      no-unaliased: true
      no-extra-aliases: false
    inamedparam:
      skip-single-param: false
    interfacebloat:
      max: 10
    lll:
      line-length: 250
      tab-width: 1
    maintidx:
      under: 15
    makezero:
      always: false
    misspell:
      locale: US
      ignore-rules:
        - cancelled
        - cancelling
    nakedret:
      max-func-lines: 30
    nestif:
      min-complexity: 5
    prealloc:
      simple: true
      range-loops: true
      for-loops: false
    revive:
      severity: warning
      enable-all-rules: false
      enable-default-rules: true
    sloglint:
      no-mixed-args: true
      kv-only: false
      attr-only: false
      no-global: ""
      context: all
      static-msg: false
      no-raw-keys: false
      key-naming-case: snake
      args-on-sep-lines: false
    spancheck:
      checks:
        - end
        - record-error
        - set-status
      ignore-check-signatures:
        - telemetry.RecordError
    tagliatelle:
      case:
        use-field-name: false
        rules:
          json: snake
    testpackage:
      skip-regexp: .*(export)_test\.go
    unconvert:
      fast-math: true
      safe: true
    unparam:
      check-exported: true
    unused:
      field-writes-are-uses: true
      post-statements-are-reads: false
      exported-fields-are-used: true
      parameters-are-used: true
      local-variables-are-used: true
      generated-is-used: true
    usestdlibvars:
      http-method: true
      http-status-code: true
      time-weekday: true
      time-month: false
      time-layout: true
      crypto-hash: true
      tls-signature-scheme: false
      constant-kind: false
    usetesting:
      os-create-temp: true
      os-mkdir-temp: true
      os-setenv: true
      os-temp-dir: true
      os-chdir: true
      context-background: true
      context-todo: true
    varnamelen:
      max-distance: 5
      min-name-length: 1
      check-receiver: true
      check-return: true
      ignore-type-assert-ok: false
      ignore-map-index-ok: false
      ignore-chan-recv-ok: false
    whitespace:
      multi-if: false
      multi-func: true

  exclusions:
    generated: lax
    presets:
      - comments
      - std-error-handling
      - common-false-positives
      - legacy
    rules:
      - linters:
          - cyclop
          - funlen
          - gocognit
          - goconst
          - gocritic
          - gocyclo
          - gosec
          - lll
          - wrapcheck
        path: _test\.go

      - linters:
          - lll
        source: "^//go:generate "

      - linters:
          - govet
        text: 'shadow: declaration of "err|ok|ctx"'

      - linters:
          - nlreturn
        text: continue with no blank line before

      # gosec(G404): Insecure random number source (rand)
      # staticcheck(ST1003): Poorly chosen identifier: https://staticcheck.dev/docs/checks/#ST1003
      - path: (.+)\.go$
        text: (G404|ST1003) 

      - path: (.+)\.go$
        text: Error return value of `.*.Add(Array|Object)` is not checked
